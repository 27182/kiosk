{"ast":null,"code":"import { resolveComponent as _resolveComponent, createVNode as _createVNode, vShow as _vShow, createElementVNode as _createElementVNode, withDirectives as _withDirectives, openBlock as _openBlock, createElementBlock as _createElementBlock, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nconst _withScopeId = n => (_pushScopeId(\"data-v-263aa801\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  class: \"wrapper\"\n};\nconst _hoisted_2 = {\n  class: \"loading-progress\"\n};\nconst _hoisted_3 = [\"src\"];\nconst _hoisted_4 = {\n  class: \"notice\"\n};\nconst _hoisted_5 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"div\", {\n  style: {\n    \"border-radius\": \"25px\",\n    \"background-color\": \"white\",\n    \"padding\": \"5px 10px\"\n  }\n}, \" 테스트용 키로 구현하여 결제하여도 실제 돈은 빠져나가지 않습니다. \", -1 /* HOISTED */));\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_v_progress_circular = _resolveComponent(\"v-progress-circular\");\n  const _component_v_btn = _resolveComponent(\"v-btn\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_withDirectives(_createElementVNode(\"div\", _hoisted_2, [_createVNode(_component_v_progress_circular, {\n    size: 74,\n    width: 8,\n    indeterminate: \"\",\n    color: \"yellow\"\n  })], 512 /* NEED_PATCH */), [[_vShow, $setup.isWaitingtoload]]), _withDirectives(_createElementVNode(\"iframe\", {\n    ref: \"frame\",\n    class: \"pay-frame\",\n    src: $setup.kakaoLink\n  }, \"\\r\\n\\r\\n        \", 8 /* PROPS */, _hoisted_3), [[_vShow, !$setup.isWaitingtoload]]), _createElementVNode(\"div\", _hoisted_4, [_createElementVNode(\"h4\", null, [_hoisted_5, _createVNode(_component_v_btn, {\n    text: \"결제 스킵하기\",\n    color: \"red\",\n    onClick: $setup.skip\n  })])])]);\n}","map":{"version":3,"names":["class","_createElementVNode","style","_createElementBlock","_hoisted_1","_hoisted_2","_createVNode","_component_v_progress_circular","size","width","indeterminate","color","$setup","isWaitingtoload","ref","src","kakaoLink","_hoisted_3","_hoisted_4","_hoisted_5","_component_v_btn","text","onClick","skip"],"sources":["C:\\Users\\1\\Desktop\\vvvv\\frontend\\src\\views\\PaymentView.vue"],"sourcesContent":["<template>\r\n    <div class=\"wrapper\">\r\n        <div class=\"loading-progress\" v-show=\"isWaitingtoload\">\r\n            <v-progress-circular :size=\"74\" :width=\"8\" indeterminate color=\"yellow\"></v-progress-circular>\r\n        </div>\r\n\r\n        <iframe ref=\"frame\" class=\"pay-frame\" :src=\"kakaoLink\" v-show=\"!isWaitingtoload\">\r\n\r\n        </iframe>\r\n        <div class=\"notice\">\r\n            <h4>\r\n                <div style=\"border-radius: 25px; background-color: white; padding: 5px 10px;\">\r\n                    테스트용 키로 구현하여 결제하여도 실제 돈은 빠져나가지 않습니다.\r\n                </div>\r\n                <v-btn text=\"결제 스킵하기\" color=\"red\" @click=\"skip\">\r\n\r\n                </v-btn>\r\n            </h4>\r\n        </div>\r\n\r\n\r\n\r\n    </div>\r\n</template>\r\n\r\n\r\n\r\n<script setup>\r\nimport axios from 'axios';\r\n// import { computed } from 'vue';\r\n// import { watch } from 'vue';\r\nimport { onMounted } from 'vue';\r\nimport { ref } from 'vue'\r\nimport { useRouter } from 'vue-router';\r\n\r\nlet kakaoLink = ref(\"\");\r\n\r\nlet myCart = [];\r\n\r\nlet orderData = ref({});\r\n\r\nlet frame = ref(null);\r\n\r\nlet ono = 0;\r\n\r\n// let frame_href = ref(\"\");\r\n\r\nlet isWaitingtoload = ref(true);\r\n\r\n\r\nonMounted(() => {\r\n    if (history.state.myCart != null) {\r\n        myCart = history.state.myCart;\r\n    }\r\n\r\n    orderData.value = history.state.orderData;\r\n\r\n    // console.log(frame.value);\r\n\r\n    getReadytoPay();\r\n\r\n})\r\n\r\n// computed(()=>{\r\n//     frame_href.value = frame.value.contentWindow.location.href;\r\n// })\r\n\r\n\r\n\r\n// watch(frame_href,()=>{\r\n//     try{\r\n//         frame_href.value = frame.value.contentWindow.location.href;\r\n//         if(frame_href.value.indexOf(\"pg_token\") !== -1){\r\n//             alert('!!')\r\n//         }\r\n//         console.log(frame_href.value)\r\n//     } catch(e){\r\n//         console.log(e);\r\n//     }\r\n// })\r\n\r\nconst router = useRouter();\r\nwindow.addEventListener('message', function (e) {\r\n    if (e.data.isSuccess === 'true') {\r\n        let sendingCart = myCart;\r\n        router.push({\r\n            path: '/result', name: 'result', state: {\r\n                ono: e.data.ono,\r\n                myCart: sendingCart,\r\n            }\r\n        });\r\n    } else if(e.data.isSuccess === 'false'){\r\n        router.push({\r\n            path: '/menu', name: 'menu', state: {\r\n                cancelPay: \"true\"\r\n            }\r\n        });\r\n    }\r\n})\r\n\r\n\r\nfunction getReadytoPay() {\r\n    axios.post('/api/kakaopay/ready', orderData.value).then((res) => {\r\n        kakaoLink.value = res.data.next_redirect_pc_url;\r\n        ono = res.data.ono;\r\n        setTimeout(() => { isWaitingtoload.value = false }, 500)\r\n    })\r\n}\r\n\r\n\r\nfunction skip() {\r\n\r\n    isWaitingtoload.value = true;\r\n\r\n    orderData.value.ono = ono\r\n\r\n    axios.post('/api/order', orderData.value\r\n    ).then((res) => {\r\n        if (res.data.isSuccess) {\r\n            setTimeout(() => {\r\n                isWaitingtoload.value = false;\r\n                let sendingCart = myCart;\r\n                router.push({\r\n                    path: '/result', name: 'result', state: {\r\n                        ono: res.data.ono,\r\n                        myCart: sendingCart,\r\n                    }\r\n                });\r\n            }, 1000\r\n            );\r\n        } else {\r\n            alert('오류: 주문 접수 실패');\r\n            isWaitingtoload.value = false;\r\n        }\r\n\r\n    })\r\n}\r\n\r\n\r\n</script>\r\n\r\n\r\n<script>\r\n\r\nexport default {\r\n    name: 'PaymentView'\r\n}\r\n\r\n\r\n</script>\r\n\r\n\r\n<style scoped>\r\n.wrapper {\r\n    height: 100vh;\r\n    width: 35em;\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n}\r\n\r\n.notice {\r\n    color: red;\r\n}\r\n\r\n.pay-frame {\r\n    width: 100%;\r\n    height: 80%;\r\n    border: none;\r\n    border-radius: 25px;\r\n}\r\n\r\n.loading-progress {\r\n    height: 80%;\r\n    width: 100%;\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n    justify-content: center;\r\n    z-index: 1;\r\n}\r\n</style>"],"mappings":";;;EACSA,KAAK,EAAC;AAAS;;EACXA,KAAK,EAAC;AAAkB;;;EAOxBA,KAAK,EAAC;AAAQ;gEAEXC,mBAAA,CAEM;EAFDC,KAAwE,EAAxE;IAAA;IAAA;IAAA;EAAA;AAAwE,GAAC,wCAE9E;;;;uBAZZC,mBAAA,CAqBM,OArBNC,UAqBM,G,gBApBFH,mBAAA,CAEM,OAFNI,UAEM,GADFC,YAAA,CAA8FC,8BAAA;IAAxEC,IAAI,EAAE,EAAE;IAAGC,KAAK,EAAE,CAAC;IAAEC,aAAa,EAAb,EAAa;IAACC,KAAK,EAAC;wCAD7BC,MAAA,CAAAC,eAAe,E,mBAIrDZ,mBAAA,CAES;IAFDa,GAAG,EAAC,OAAO;IAACd,KAAK,EAAC,WAAW;IAAEe,GAAG,EAAEH,MAAA,CAAAI;KAAqC,kBAEjF,iBAAAC,UAAA,I,UAFgEL,MAAA,CAAAC,eAAe,E,GAG/EZ,mBAAA,CASM,OATNiB,UASM,GARFjB,mBAAA,CAOK,aANDkB,UAEM,EACNb,YAAA,CAEQc,gBAAA;IAFDC,IAAI,EAAC,SAAS;IAACV,KAAK,EAAC,KAAK;IAAEW,OAAK,EAAEV,MAAA,CAAAW"},"metadata":{},"sourceType":"module","externalDependencies":[]}