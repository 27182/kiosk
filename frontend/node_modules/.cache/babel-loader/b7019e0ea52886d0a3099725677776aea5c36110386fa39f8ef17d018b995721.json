{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport axios from 'axios';\n// import { computed } from 'vue';\n// import { watch } from 'vue';\nimport { onMounted } from 'vue';\nimport { ref } from 'vue';\nimport { useRouter } from 'vue-router';\nconst __default__ = {\n  name: 'PaymentView'\n};\nexport default /*#__PURE__*/Object.assign(__default__, {\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    let kakaoLink = ref(\"\");\n    let myCart = [];\n    let orderData = ref({});\n    let frame = ref(null);\n    let ono = 0;\n\n    // let frame_href = ref(\"\");\n\n    let isWaitingtoload = ref(true);\n    onMounted(() => {\n      if (history.state.myCart != null) {\n        myCart = history.state.myCart;\n      }\n      orderData.value = history.state.orderData;\n\n      // console.log(frame.value);\n\n      getReadytoPay();\n    });\n\n    // computed(()=>{\n    //     frame_href.value = frame.value.contentWindow.location.href;\n    // })\n\n    // watch(frame_href,()=>{\n    //     try{\n    //         frame_href.value = frame.value.contentWindow.location.href;\n    //         if(frame_href.value.indexOf(\"pg_token\") !== -1){\n    //             alert('!!')\n    //         }\n    //         console.log(frame_href.value)\n    //     } catch(e){\n    //         console.log(e);\n    //     }\n    // })\n\n    const router = useRouter();\n    window.addEventListener('message', function (e) {\n      if (e.data.isSuccess === 'true') {\n        let sendingCart = myCart;\n        router.push({\n          path: '/result',\n          name: 'result',\n          state: {\n            ono: e.data.ono,\n            myCart: sendingCart\n          }\n        });\n      } else if (e.data.isSuccess === 'false') {\n        router.push({\n          path: '/menu',\n          name: 'menu',\n          state: {\n            cancelPay: \"true\"\n          }\n        });\n      }\n    });\n    function getReadytoPay() {\n      axios.post('/api/kakaopay/ready', orderData.value).then(res => {\n        kakaoLink.value = res.data.next_redirect_pc_url;\n        ono = res.data.ono;\n        setTimeout(() => {\n          isWaitingtoload.value = false;\n        }, 500);\n      });\n    }\n    function skip() {\n      isWaitingtoload.value = true;\n      orderData.value.ono = ono;\n      axios.post('/api/order', orderData.value).then(res => {\n        if (res.data.isSuccess) {\n          setTimeout(() => {\n            isWaitingtoload.value = false;\n            let sendingCart = myCart;\n            router.push({\n              path: '/result',\n              name: 'result',\n              state: {\n                ono: res.data.ono,\n                myCart: sendingCart\n              }\n            });\n          }, 1000);\n        } else {\n          alert('오류: 주문 접수 실패');\n          isWaitingtoload.value = false;\n        }\n      });\n    }\n    const __returned__ = {\n      get kakaoLink() {\n        return kakaoLink;\n      },\n      set kakaoLink(v) {\n        kakaoLink = v;\n      },\n      get myCart() {\n        return myCart;\n      },\n      set myCart(v) {\n        myCart = v;\n      },\n      get orderData() {\n        return orderData;\n      },\n      set orderData(v) {\n        orderData = v;\n      },\n      get frame() {\n        return frame;\n      },\n      set frame(v) {\n        frame = v;\n      },\n      get ono() {\n        return ono;\n      },\n      set ono(v) {\n        ono = v;\n      },\n      get isWaitingtoload() {\n        return isWaitingtoload;\n      },\n      set isWaitingtoload(v) {\n        isWaitingtoload = v;\n      },\n      router,\n      getReadytoPay,\n      skip,\n      get axios() {\n        return axios;\n      },\n      onMounted,\n      ref,\n      get useRouter() {\n        return useRouter;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n});","map":{"version":3,"names":["axios","onMounted","ref","useRouter","__default__","name","kakaoLink","myCart","orderData","frame","ono","isWaitingtoload","history","state","value","getReadytoPay","router","window","addEventListener","e","data","isSuccess","sendingCart","push","path","cancelPay","post","then","res","next_redirect_pc_url","setTimeout","skip","alert"],"sources":["C:/Users/201-14/Desktop/vvvvvvvvvvvvvvvvv/frontend/src/views/PaymentView.vue"],"sourcesContent":["<template>\r\n    <div class=\"wrapper\">\r\n        <div class=\"loading-progress\" v-show=\"isWaitingtoload\">\r\n            <v-progress-circular :size=\"74\" :width=\"8\" indeterminate color=\"yellow\"></v-progress-circular>\r\n        </div>\r\n\r\n        <iframe ref=\"frame\" class=\"pay-frame\" :src=\"kakaoLink\" v-show=\"!isWaitingtoload\">\r\n\r\n        </iframe>\r\n        <div class=\"notice\">\r\n            <h4>\r\n                테스트용 키로 구현하여 결제하여도 실제 돈은 빠져나가지 않습니다.\r\n                <v-btn text=\"결제 스킵하기\" color=\"red\" @click=\"skip\">\r\n\r\n                </v-btn>\r\n            </h4>\r\n        </div>\r\n\r\n\r\n\r\n    </div>\r\n</template>\r\n\r\n\r\n\r\n<script setup>\r\nimport axios from 'axios';\r\n// import { computed } from 'vue';\r\n// import { watch } from 'vue';\r\nimport { onMounted } from 'vue';\r\nimport { ref } from 'vue'\r\nimport { useRouter } from 'vue-router';\r\n\r\nlet kakaoLink = ref(\"\");\r\n\r\nlet myCart = [];\r\n\r\nlet orderData = ref({});\r\n\r\nlet frame = ref(null);\r\n\r\nlet ono = 0;\r\n\r\n// let frame_href = ref(\"\");\r\n\r\nlet isWaitingtoload = ref(true);\r\n\r\n\r\nonMounted(() => {\r\n    if (history.state.myCart != null) {\r\n        myCart = history.state.myCart;\r\n    }\r\n\r\n    orderData.value = history.state.orderData;\r\n\r\n    // console.log(frame.value);\r\n\r\n    getReadytoPay();\r\n\r\n})\r\n\r\n// computed(()=>{\r\n//     frame_href.value = frame.value.contentWindow.location.href;\r\n// })\r\n\r\n\r\n\r\n// watch(frame_href,()=>{\r\n//     try{\r\n//         frame_href.value = frame.value.contentWindow.location.href;\r\n//         if(frame_href.value.indexOf(\"pg_token\") !== -1){\r\n//             alert('!!')\r\n//         }\r\n//         console.log(frame_href.value)\r\n//     } catch(e){\r\n//         console.log(e);\r\n//     }\r\n// })\r\n\r\nconst router = useRouter();\r\nwindow.addEventListener('message', function (e) {\r\n    if (e.data.isSuccess === 'true') {\r\n        let sendingCart = myCart;\r\n        router.push({\r\n            path: '/result', name: 'result', state: {\r\n                ono: e.data.ono,\r\n                myCart: sendingCart,\r\n            }\r\n        });\r\n    } else if(e.data.isSuccess === 'false'){\r\n        router.push({\r\n            path: '/menu', name: 'menu', state: {\r\n                cancelPay: \"true\"\r\n            }\r\n        });\r\n    }\r\n})\r\n\r\n\r\nfunction getReadytoPay() {\r\n    axios.post('/api/kakaopay/ready', orderData.value).then((res) => {\r\n        kakaoLink.value = res.data.next_redirect_pc_url;\r\n        ono = res.data.ono;\r\n        setTimeout(() => { isWaitingtoload.value = false }, 500)\r\n    })\r\n}\r\n\r\n\r\nfunction skip() {\r\n\r\n    isWaitingtoload.value = true;\r\n\r\n    orderData.value.ono = ono\r\n\r\n    axios.post('/api/order', orderData.value\r\n    ).then((res) => {\r\n        if (res.data.isSuccess) {\r\n            setTimeout(() => {\r\n                isWaitingtoload.value = false;\r\n                let sendingCart = myCart;\r\n                router.push({\r\n                    path: '/result', name: 'result', state: {\r\n                        ono: res.data.ono,\r\n                        myCart: sendingCart,\r\n                    }\r\n                });\r\n            }, 1000\r\n            );\r\n        } else {\r\n            alert('오류: 주문 접수 실패');\r\n            isWaitingtoload.value = false;\r\n        }\r\n\r\n    })\r\n}\r\n\r\n\r\n</script>\r\n\r\n\r\n<script>\r\n\r\nexport default {\r\n    name: 'PaymentView'\r\n}\r\n\r\n\r\n</script>\r\n\r\n\r\n<style scoped>\r\n.wrapper {\r\n    height: 100vh;\r\n    width: 35em;\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n}\r\n\r\n.notice {\r\n    color: red;\r\n}\r\n\r\n.pay-frame {\r\n    width: 100%;\r\n    height: 80%;\r\n    border: none;\r\n    border-radius: 25px;\r\n}\r\n\r\n.loading-progress {\r\n    height: 80%;\r\n    width: 100%;\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n    justify-content: center;\r\n    z-index: 1;\r\n}\r\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}